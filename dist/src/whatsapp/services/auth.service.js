'use strict';const a51_0x25ff1e=a51_0x156b;(function(_0x39e09b,_0x463e80){const _0x168ac7=a51_0x156b,_0x1ef085=_0x39e09b();while(!![]){try{const _0x33e58c=-parseInt(_0x168ac7(0x164))/0x1+parseInt(_0x168ac7(0x162))/0x2*(-parseInt(_0x168ac7(0x170))/0x3)+-parseInt(_0x168ac7(0x15a))/0x4+-parseInt(_0x168ac7(0x179))/0x5+parseInt(_0x168ac7(0x158))/0x6+-parseInt(_0x168ac7(0x15d))/0x7+parseInt(_0x168ac7(0x16f))/0x8;if(_0x33e58c===_0x463e80)break;else _0x1ef085['push'](_0x1ef085['shift']());}catch(_0x310ef9){_0x1ef085['push'](_0x1ef085['shift']());}}}(a51_0x3ce7,0xe69e9));function a51_0x156b(_0x8ff51b,_0x63ff13){const _0x3ce7a8=a51_0x3ce7();return a51_0x156b=function(_0x156b8f,_0x537809){_0x156b8f=_0x156b8f-0x13b;let _0x8b0f28=_0x3ce7a8[_0x156b8f];return _0x8b0f28;},a51_0x156b(_0x8ff51b,_0x63ff13);}var __awaiter=this&&this['__awaiter']||function(_0x2e18de,_0x3ce252,_0x56b9d5,_0x26e97a){function _0xe0a553(_0x2979bc){return _0x2979bc instanceof _0x56b9d5?_0x2979bc:new _0x56b9d5(function(_0x1322d9){_0x1322d9(_0x2979bc);});}return new(_0x56b9d5||(_0x56b9d5=Promise))(function(_0x37e535,_0x52bad5){const _0x1e7706=a51_0x156b;function _0x45b320(_0x185b11){const _0x1b0a90=a51_0x156b;try{_0x479c7d(_0x26e97a[_0x1b0a90(0x172)](_0x185b11));}catch(_0x352b13){_0x52bad5(_0x352b13);}}function _0x48087d(_0x63dd0e){const _0x29fbc1=a51_0x156b;try{_0x479c7d(_0x26e97a[_0x29fbc1(0x15c)](_0x63dd0e));}catch(_0x4a1308){_0x52bad5(_0x4a1308);}}function _0x479c7d(_0x5898f3){const _0x333351=a51_0x156b;_0x5898f3[_0x333351(0x173)]?_0x37e535(_0x5898f3[_0x333351(0x151)]):_0xe0a553(_0x5898f3[_0x333351(0x151)])[_0x333351(0x13b)](_0x45b320,_0x48087d);}_0x479c7d((_0x26e97a=_0x26e97a[_0x1e7706(0x16c)](_0x2e18de,_0x3ce252||[]))[_0x1e7706(0x172)]());});},__importDefault=this&&this[a51_0x25ff1e(0x146)+a51_0x25ff1e(0x153)]||function(_0x2a207c){const _0x5ef103=a51_0x25ff1e;return _0x2a207c&&_0x2a207c[_0x5ef103(0x183)]?_0x2a207c:{'default':_0x2a207c};};const a51_0x378c7d={};function a51_0x3ce7(){const _0x3cd9ee=['isJWT','defineProp','enabled','AUTHENTICA','__esModule','create','SECRET','ration','instanceNa','then','OldToken','config','refreshTok','generateHa','error','auth','WEBHOOK','waInstance','Invalid\x20\x22o','tion\x20error','__importDe','dator','sign','instance','toUpperCas','name','post','../../../p','.jwt','ownre','get','value','g-t','fault','logger','.refreshTo','EXPIRIN_IN','class-vali','5324670eIHSBK','localError','7055508NMWTbO','ldToken\x22','throw','4551463sVQFtS','AuthServic','repository','params','TION','38djMEWZ','JWT','1379818PqcbIr','ice','apikey','configServ','baseURL','../../conf','waMonitor','jwt','apply','erty','ignoreExpi','48835768Srnter','171006TWOrfe','Exception','next','done','tokenId','find','Authentica','jsonwebtok','EVENTS','5851785AuNwcM','axios','webhook','BadRequest','uuid','verify'];a51_0x3ce7=function(){return _0x3cd9ee;};return a51_0x3ce7();}a51_0x378c7d['value']=!![],Object[a51_0x25ff1e(0x180)+a51_0x25ff1e(0x16d)](exports,a51_0x25ff1e(0x183),a51_0x378c7d),exports['AuthServic'+'e']=exports[a51_0x25ff1e(0x13c)]=void 0x0;const package_json_1=require(a51_0x25ff1e(0x14d)+'ackage.jso'+'n'),jsonwebtoken_1=require(a51_0x25ff1e(0x177)+'en'),logger_config_1=require(a51_0x25ff1e(0x169)+'ig/logger.'+a51_0x25ff1e(0x13d)),uuid_1=require(a51_0x25ff1e(0x17d)),class_validator_1=require(a51_0x25ff1e(0x157)+a51_0x25ff1e(0x147)),exceptions_1=require('../../exce'+'ptions'),axios_1=__importDefault(require(a51_0x25ff1e(0x17a)));class OldToken{}exports[a51_0x25ff1e(0x13c)]=OldToken;class AuthService{constructor(_0x3da867,_0xa2ca2e,_0xd7647e){const _0x2dae10=a51_0x25ff1e;this[_0x2dae10(0x167)+_0x2dae10(0x165)]=_0x3da867,this[_0x2dae10(0x16a)]=_0xa2ca2e,this['repository']=_0xd7647e,this[_0x2dae10(0x154)]=new logger_config_1['Logger'](AuthService[_0x2dae10(0x14b)]);}['jwt'](_0x1aa0f7){var _0x414776;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4ea0f9=a51_0x156b,_0x5eee2c=this[_0x4ea0f9(0x167)+_0x4ea0f9(0x165)][_0x4ea0f9(0x150)]('AUTHENTICA'+_0x4ea0f9(0x161))[_0x4ea0f9(0x163)],_0x5b60c0=(0x0,jsonwebtoken_1[_0x4ea0f9(0x148)])({'instanceName':_0x1aa0f7[_0x4ea0f9(0x187)+'me'],'apiName':package_json_1[_0x4ea0f9(0x14b)],'tokenId':(0x0,uuid_1['v4'])()},_0x5eee2c[_0x4ea0f9(0x185)],{'expiresIn':_0x5eee2c[_0x4ea0f9(0x156)],'encoding':'utf8','subject':_0x4ea0f9(0x152)}),_0x259f8c={};_0x259f8c[_0x4ea0f9(0x16b)]=_0x5b60c0;const _0x5e5bb2=yield this[_0x4ea0f9(0x15f)][_0x4ea0f9(0x141)]['create'](_0x259f8c,_0x1aa0f7[_0x4ea0f9(0x187)+'me']);if(_0x5e5bb2[_0x4ea0f9(0x140)]){const _0x4e979b={};_0x4e979b[_0x4ea0f9(0x159)]=AuthService['name']+_0x4ea0f9(0x14e),_0x4e979b[_0x4ea0f9(0x140)]=_0x5e5bb2[_0x4ea0f9(0x140)],this['logger'][_0x4ea0f9(0x140)](_0x4e979b);throw new exceptions_1[(_0x4ea0f9(0x17c))+(_0x4ea0f9(0x171))]('Authentica'+_0x4ea0f9(0x145),(_0x414776=_0x5e5bb2[_0x4ea0f9(0x140)])===null||_0x414776===void 0x0?void 0x0:_0x414776['toString']());}const _0x73eee0={};return _0x73eee0[_0x4ea0f9(0x16b)]=_0x5b60c0,_0x73eee0;});}[a51_0x25ff1e(0x166)](_0x5d7fa0){var _0x58427f;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x24da59=a51_0x156b,_0x3d27a8=(0x0,uuid_1['v4'])()[_0x24da59(0x14a)+'e'](),_0x977698={};_0x977698['apikey']=_0x3d27a8;const _0x3ea1ee=yield this['repository'][_0x24da59(0x141)]['create'](_0x977698,_0x5d7fa0[_0x24da59(0x187)+'me']);if(_0x3ea1ee[_0x24da59(0x140)]){const _0x1a9d0b={};_0x1a9d0b[_0x24da59(0x159)]=AuthService[_0x24da59(0x14b)]+'.jwt',_0x1a9d0b['error']=_0x3ea1ee['error'],this[_0x24da59(0x154)][_0x24da59(0x140)](_0x1a9d0b);throw new exceptions_1['BadRequest'+(_0x24da59(0x171))](_0x24da59(0x176)+_0x24da59(0x145),(_0x58427f=_0x3ea1ee[_0x24da59(0x140)])===null||_0x58427f===void 0x0?void 0x0:_0x58427f['toString']());}const _0x292346={};return _0x292346['apikey']=_0x3d27a8,_0x292346;});}[a51_0x25ff1e(0x13f)+'sh'](_0x82ddec){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3d01b9=a51_0x156b,_0x25f2e3=this['configServ'+'ice'][_0x3d01b9(0x150)](_0x3d01b9(0x182)+_0x3d01b9(0x161));return yield this[_0x25f2e3['TYPE']](_0x82ddec);});}[a51_0x25ff1e(0x13e)+'en']({oldToken:_0x5cd624}){return __awaiter(this,void 0x0,void 0x0,function*(){const _0xb0395=a51_0x156b;if(!(0x0,class_validator_1[_0xb0395(0x17f)])(_0x5cd624))throw new exceptions_1[(_0xb0395(0x17c))+(_0xb0395(0x171))](_0xb0395(0x144)+_0xb0395(0x15b));try{const _0x4fee4b=this[_0xb0395(0x167)+_0xb0395(0x165)]['get'](_0xb0395(0x182)+_0xb0395(0x161))[_0xb0395(0x163)],_0x4d7bc9={};_0x4d7bc9[_0xb0395(0x16e)+_0xb0395(0x186)]=!![];const _0x4e80f1=(0x0,jsonwebtoken_1[_0xb0395(0x17e)])(_0x5cd624,_0x4fee4b[_0xb0395(0x185)],_0x4d7bc9),_0x2cb3a0=yield this['repository'][_0xb0395(0x141)][_0xb0395(0x175)](_0x4e80f1[_0xb0395(0x187)+'me']),_0x191e44={};_0x191e44[_0xb0395(0x16e)+_0xb0395(0x186)]=!![];const _0x2f96f9=(0x0,jsonwebtoken_1[_0xb0395(0x17e)])(_0x2cb3a0[_0xb0395(0x16b)],_0x4fee4b['SECRET'],_0x191e44);if(_0x4e80f1[_0xb0395(0x174)]!==_0x2f96f9[_0xb0395(0x174)])throw new exceptions_1[(_0xb0395(0x17c))+(_0xb0395(0x171))]('Invalid\x20\x22o'+_0xb0395(0x15b));const _0x1adace={};_0x1adace[_0xb0395(0x187)+'me']=_0x4e80f1[_0xb0395(0x187)+'me'];const _0x5ebb14={'jwt':(yield this[_0xb0395(0x16b)](_0x1adace))[_0xb0395(0x16b)],'instanceName':_0x4e80f1['instanceNa'+'me']};try{const _0x39e5bc=yield this[_0xb0395(0x15f)][_0xb0395(0x17b)]['find'](_0x4e80f1['instanceNa'+'me']);if(_0x39e5bc[_0xb0395(0x181)]&&this['configServ'+'ice'][_0xb0395(0x150)](_0xb0395(0x142))[_0xb0395(0x178)]['NEW_JWT_TO'+'KEN']){const _0x599e38={};_0x599e38[_0xb0395(0x168)]=_0x39e5bc['url'];const _0x42fa99=axios_1['default'][_0xb0395(0x184)](_0x599e38),_0x5c49d6={};_0x5c49d6['event']='new.jwt',_0x5c49d6[_0xb0395(0x149)]=_0x4e80f1[_0xb0395(0x187)+'me'],_0x5c49d6['data']=_0x5ebb14;const _0x1c1d4f={};_0x1c1d4f[_0xb0395(0x14f)]=this[_0xb0395(0x16a)][_0xb0395(0x143)+'s'][_0x4e80f1['instanceNa'+'me']]['wuid'];const _0x2dd60f={};_0x2dd60f[_0xb0395(0x160)]=_0x1c1d4f,yield _0x42fa99[_0xb0395(0x14c)]('',_0x5c49d6,_0x2dd60f);}}catch(_0x180186){this[_0xb0395(0x154)][_0xb0395(0x140)](_0x180186);}return _0x5ebb14;}catch(_0x874f3d){const _0x20bb2c={};_0x20bb2c[_0xb0395(0x159)]=AuthService['name']+(_0xb0395(0x155)+'ken'),_0x20bb2c[_0xb0395(0x140)]=_0x874f3d,this['logger']['error'](_0x20bb2c);throw new exceptions_1[(_0xb0395(0x17c))+(_0xb0395(0x171))](_0xb0395(0x144)+_0xb0395(0x15b));}});}}exports[a51_0x25ff1e(0x15e)+'e']=AuthService;