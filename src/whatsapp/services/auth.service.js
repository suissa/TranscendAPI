'use strict';const a52_0x1c2421=a52_0x4447;function a52_0x2234(){const _0x38b186=['logger','AuthServic','3521980jWTMVQ','ice','then','enabled','apikey','EXPIRIN_IN','ackage.jso','AUTHENTICA','../../../p','instanceNa','ken','ignoreExpi','post','TION','auth','defineProp','dator','tion\x20error','4289178LRLykm','value','SECRET','refreshTok','ration','133192dAOcRc','__esModule','ldToken\x22','params','tokenId','JWT','class-vali','Exception','name','repository','default','jsonwebtok','NEW_JWT_TO','verify','done','webhook','g-t','../../exce','698823fhGBRo','find','get','WEBHOOK','waMonitor','.jwt','BadRequest','1252290wyuYfK','toString','.refreshTo','error','owner','next','toUpperCas','url','create','39dXOnQz','jwt','localError','utf8','7mFqUHp','throw','configServ','Invalid\x20\x22o','wuid','KEN','ig/logger.','baseURL','apply','new.jwt','fault','Authentica','OldToken','5HzxuHK','94634pGOznd','41832120HJWDgI','uuid','88AsliRB','erty','instance','isJWT'];a52_0x2234=function(){return _0x38b186;};return a52_0x2234();}(function(_0x421d5f,_0x2f1aa7){const _0x5c0632=a52_0x4447,_0xe57e63=_0x421d5f();while(!![]){try{const _0xecb077=-parseInt(_0x5c0632(0x23e))/(0x696+0x2170+-0x2805)+parseInt(_0x5c0632(0x205))/(0x25e3+-0x1159+-0x1488)*(-parseInt(_0x5c0632(0x1f3))/(-0x14bc+0x2152+0x431*-0x3))+-parseInt(_0x5c0632(0x225))/(0x54e+0x11c4+-0x170e)*(parseInt(_0x5c0632(0x204))/(-0x1a1d+-0x932+0x2354))+parseInt(_0x5c0632(0x220))/(0x25*-0xd1+-0x935*0x2+-0x1037*-0x3)*(-parseInt(_0x5c0632(0x1f7))/(-0xa66+0xd8f+0x2*-0x191))+parseInt(_0x5c0632(0x208))/(0x1db5+-0x2*-0x7f+0x1eab*-0x1)*(-parseInt(_0x5c0632(0x237))/(-0x2676+-0x1290+0x390f))+parseInt(_0x5c0632(0x20e))/(0xb2b+-0x509+-0xd*0x78)+parseInt(_0x5c0632(0x206))/(0x1af2+0x2513+-0x3ffa);if(_0xecb077===_0x2f1aa7)break;else _0xe57e63['push'](_0xe57e63['shift']());}catch(_0x5ddc5c){_0xe57e63['push'](_0xe57e63['shift']());}}}(a52_0x2234,-0x51a33*0x4+-0xa0025+0x28de66*0x1));var __awaiter=this&&this['__awaiter']||function(_0x2c2a5e,_0x488979,_0x5d27e4,_0x3081ba){function _0x13e15d(_0x3a8802){return _0x3a8802 instanceof _0x5d27e4?_0x3a8802:new _0x5d27e4(function(_0x41cb5c){_0x41cb5c(_0x3a8802);});}return new(_0x5d27e4||(_0x5d27e4=Promise))(function(_0x565965,_0x3648dc){const _0x4e4bbb=a52_0x4447;function _0x37826a(_0x226d5a){const _0x33bb08=a52_0x4447;try{_0x28564c(_0x3081ba[_0x33bb08(0x243)](_0x226d5a));}catch(_0x56adf2){_0x3648dc(_0x56adf2);}}function _0xdcc1ad(_0x13bfc2){const _0x3594c4=a52_0x4447;try{_0x28564c(_0x3081ba[_0x3594c4(0x1f8)](_0x13bfc2));}catch(_0x5e58db){_0x3648dc(_0x5e58db);}}function _0x28564c(_0x1cfcf8){const _0x2fe03a=a52_0x4447;_0x1cfcf8[_0x2fe03a(0x233)]?_0x565965(_0x1cfcf8[_0x2fe03a(0x221)]):_0x13e15d(_0x1cfcf8[_0x2fe03a(0x221)])[_0x2fe03a(0x210)](_0x37826a,_0xdcc1ad);}_0x28564c((_0x3081ba=_0x3081ba[_0x4e4bbb(0x1ff)](_0x2c2a5e,_0x488979||[]))[_0x4e4bbb(0x243)]());});},__importDefault=this&&this['__importDe'+a52_0x1c2421(0x201)]||function(_0x5b9911){const _0x96bf34=a52_0x1c2421;return _0x5b9911&&_0x5b9911[_0x96bf34(0x226)]?_0x5b9911:{'default':_0x5b9911};};const a52_0x15956a={};a52_0x15956a['value']=!![],Object[a52_0x1c2421(0x21d)+a52_0x1c2421(0x209)](exports,a52_0x1c2421(0x226),a52_0x15956a),exports[a52_0x1c2421(0x20d)+'e']=exports[a52_0x1c2421(0x203)]=void(0x1d*-0xe+0x2*-0xe59+0x1e48);const package_json_1=require(a52_0x1c2421(0x216)+a52_0x1c2421(0x214)+'n'),jsonwebtoken_1=require(a52_0x1c2421(0x230)+'en'),logger_config_1=require('../../conf'+a52_0x1c2421(0x1fd)+'config'),uuid_1=require(a52_0x1c2421(0x207)),class_validator_1=require(a52_0x1c2421(0x22b)+a52_0x1c2421(0x21e)),exceptions_1=require(a52_0x1c2421(0x236)+'ptions'),axios_1=__importDefault(require('axios'));class OldToken{}exports[a52_0x1c2421(0x203)]=OldToken;class AuthService{constructor(_0x53cc07,_0x183a76,_0xfa878b){const _0x1ec242=a52_0x1c2421;this[_0x1ec242(0x1f9)+_0x1ec242(0x20f)]=_0x53cc07,this['waMonitor']=_0x183a76,this[_0x1ec242(0x22e)]=_0xfa878b,this[_0x1ec242(0x20c)]=new logger_config_1['Logger'](AuthService[_0x1ec242(0x22d)]);}['jwt'](_0x406edb){var _0x5322b1;return __awaiter(this,void(0x1*-0xf10+0x593+-0x97d*-0x1),void(0x2*0x80f+-0xa6*-0x2+-0x3*0x5ce),function*(){const _0x55a229=a52_0x4447,_0x2f177b=this[_0x55a229(0x1f9)+_0x55a229(0x20f)][_0x55a229(0x239)]('AUTHENTICA'+_0x55a229(0x21b))[_0x55a229(0x22a)],_0x33e35f=(0x1*0x1b25+0x2294+-0x1493*0x3,jsonwebtoken_1['sign'])({'instanceName':_0x406edb[_0x55a229(0x217)+'me'],'apiName':package_json_1[_0x55a229(0x22d)],'tokenId':(0x1*-0x1035+-0x1228+-0x13*-0x1cf,uuid_1['v4'])()},_0x2f177b[_0x55a229(0x222)],{'expiresIn':_0x2f177b[_0x55a229(0x213)],'encoding':_0x55a229(0x1f6),'subject':_0x55a229(0x235)}),_0xab980c={};_0xab980c[_0x55a229(0x1f4)]=_0x33e35f;const _0x1ddd6d=yield this[_0x55a229(0x22e)][_0x55a229(0x21c)][_0x55a229(0x246)](_0xab980c,_0x406edb['instanceNa'+'me']);if(_0x1ddd6d[_0x55a229(0x241)]){const _0x30d6bb={};_0x30d6bb[_0x55a229(0x1f5)]=AuthService['name']+_0x55a229(0x23c),_0x30d6bb['error']=_0x1ddd6d[_0x55a229(0x241)],this[_0x55a229(0x20c)][_0x55a229(0x241)](_0x30d6bb);throw new exceptions_1[(_0x55a229(0x23d))+(_0x55a229(0x22c))](_0x55a229(0x202)+_0x55a229(0x21f),(_0x5322b1=_0x1ddd6d[_0x55a229(0x241)])===null||_0x5322b1===void(0x265*-0x10+-0x1066+0x36b6)?void(-0x23d7+-0x15d3*-0x1+0xe04):_0x5322b1[_0x55a229(0x23f)]());}const _0xa87ba9={};return _0xa87ba9[_0x55a229(0x1f4)]=_0x33e35f,_0xa87ba9;});}['apikey'](_0x509dc4){var _0x1f8320;return __awaiter(this,void(0x98e+0x226d+-0x1a1*0x1b),void(0x15*0x49+-0x4ef+-0x10e),function*(){const _0x28abe6=a52_0x4447,_0x39055a=(0x2*0x5fd+0x3e9*0x3+-0x17b5,uuid_1['v4'])()[_0x28abe6(0x244)+'e'](),_0x2aa0e1={};_0x2aa0e1[_0x28abe6(0x212)]=_0x39055a;const _0xad918d=yield this[_0x28abe6(0x22e)][_0x28abe6(0x21c)][_0x28abe6(0x246)](_0x2aa0e1,_0x509dc4[_0x28abe6(0x217)+'me']);if(_0xad918d['error']){const _0x23f2b8={};_0x23f2b8[_0x28abe6(0x1f5)]=AuthService[_0x28abe6(0x22d)]+_0x28abe6(0x23c),_0x23f2b8[_0x28abe6(0x241)]=_0xad918d[_0x28abe6(0x241)],this[_0x28abe6(0x20c)][_0x28abe6(0x241)](_0x23f2b8);throw new exceptions_1['BadRequest'+(_0x28abe6(0x22c))](_0x28abe6(0x202)+_0x28abe6(0x21f),(_0x1f8320=_0xad918d['error'])===null||_0x1f8320===void(-0x13*0x178+0x18db*-0x1+-0x34c3*-0x1)?void(0x61*-0x22+0xbc*-0xc+-0x2*-0xad9):_0x1f8320[_0x28abe6(0x23f)]());}const _0x2c1592={};return _0x2c1592['apikey']=_0x39055a,_0x2c1592;});}['generateHa'+'sh'](_0x2730bc){return __awaiter(this,void(0xb91*0x3+0x2*-0x22+-0x226f),void(-0x1eda*0x1+0x1*-0x392+0x1136*0x2),function*(){const _0x277ac9=a52_0x4447,_0x33812b=this[_0x277ac9(0x1f9)+'ice']['get'](_0x277ac9(0x215)+'TION');return yield this[_0x33812b['TYPE']](_0x2730bc);});}[a52_0x1c2421(0x223)+'en']({oldToken:_0xcb4ecb}){return __awaiter(this,void(0x2c5*-0x3+-0x1*0xf31+0x1*0x1780),void(0x80e+-0x12f8+0xaea),function*(){const _0x3990b9=a52_0x4447;if(!(0x166*0x2+0x7*0x4d2+-0x248a,class_validator_1[_0x3990b9(0x20b)])(_0xcb4ecb))throw new exceptions_1[(_0x3990b9(0x23d))+(_0x3990b9(0x22c))](_0x3990b9(0x1fa)+_0x3990b9(0x227));try{const _0x4634f4=this[_0x3990b9(0x1f9)+_0x3990b9(0x20f)]['get'](_0x3990b9(0x215)+_0x3990b9(0x21b))['JWT'],_0x202ef7={};_0x202ef7['ignoreExpi'+_0x3990b9(0x224)]=!![];const _0x3d8f8a=(0x1105*0x1+0x61d+0x3f*-0x5e,jsonwebtoken_1['verify'])(_0xcb4ecb,_0x4634f4[_0x3990b9(0x222)],_0x202ef7),_0x18021f=yield this['repository'][_0x3990b9(0x21c)][_0x3990b9(0x238)](_0x3d8f8a[_0x3990b9(0x217)+'me']),_0x3dc9bc={};_0x3dc9bc[_0x3990b9(0x219)+_0x3990b9(0x224)]=!![];const _0x379b17=(-0x102d+-0x2101+0x4eb*0xa,jsonwebtoken_1[_0x3990b9(0x232)])(_0x18021f['jwt'],_0x4634f4['SECRET'],_0x3dc9bc);if(_0x3d8f8a[_0x3990b9(0x229)]!==_0x379b17[_0x3990b9(0x229)])throw new exceptions_1[(_0x3990b9(0x23d))+'Exception'](_0x3990b9(0x1fa)+_0x3990b9(0x227));const _0x22c4e5={};_0x22c4e5['instanceNa'+'me']=_0x3d8f8a[_0x3990b9(0x217)+'me'];const _0x5968d6={'jwt':(yield this[_0x3990b9(0x1f4)](_0x22c4e5))[_0x3990b9(0x1f4)],'instanceName':_0x3d8f8a[_0x3990b9(0x217)+'me']};try{const _0x34417e=yield this['repository'][_0x3990b9(0x234)][_0x3990b9(0x238)](_0x3d8f8a[_0x3990b9(0x217)+'me']);if(_0x34417e[_0x3990b9(0x211)]&&this[_0x3990b9(0x1f9)+_0x3990b9(0x20f)]['get'](_0x3990b9(0x23a))['EVENTS'][_0x3990b9(0x231)+_0x3990b9(0x1fc)]){const _0x2ea2c3={};_0x2ea2c3[_0x3990b9(0x1fe)]=_0x34417e[_0x3990b9(0x245)];const _0x39245f=axios_1[_0x3990b9(0x22f)]['create'](_0x2ea2c3),_0x5a275e={};_0x5a275e['event']=_0x3990b9(0x200),_0x5a275e[_0x3990b9(0x20a)]=_0x3d8f8a[_0x3990b9(0x217)+'me'],_0x5a275e['data']=_0x5968d6;const _0x5786ae={};_0x5786ae[_0x3990b9(0x242)]=this[_0x3990b9(0x23b)]['waInstance'+'s'][_0x3d8f8a['instanceNa'+'me']][_0x3990b9(0x1fb)];const _0x27665e={};_0x27665e[_0x3990b9(0x228)]=_0x5786ae,yield _0x39245f[_0x3990b9(0x21a)]('',_0x5a275e,_0x27665e);}}catch(_0x13b77f){this[_0x3990b9(0x20c)][_0x3990b9(0x241)](_0x13b77f);}return _0x5968d6;}catch(_0x5edb16){const _0x330f04={};_0x330f04[_0x3990b9(0x1f5)]=AuthService['name']+(_0x3990b9(0x240)+_0x3990b9(0x218)),_0x330f04[_0x3990b9(0x241)]=_0x5edb16,this[_0x3990b9(0x20c)][_0x3990b9(0x241)](_0x330f04);throw new exceptions_1[(_0x3990b9(0x23d))+'Exception'](_0x3990b9(0x1fa)+'ldToken\x22');}});}}function a52_0x4447(_0x12c2a8,_0x2fe0a0){const _0x1324e4=a52_0x2234();return a52_0x4447=function(_0x3ec19e,_0x15956a){_0x3ec19e=_0x3ec19e-(-0x102f+-0x1*-0x490+0xd92);let _0x2dc0d6=_0x1324e4[_0x3ec19e];return _0x2dc0d6;},a52_0x4447(_0x12c2a8,_0x2fe0a0);}exports[a52_0x1c2421(0x20d)+'e']=AuthService;