'use strict';const a51_0x53446b=a51_0x5212;function a51_0x5212(_0x5b8d6c,_0x380fa2){const _0x5ddaf6=a51_0x4add();return a51_0x5212=function(_0x46cf5e,_0x53e9dd){_0x46cf5e=_0x46cf5e-(0x5b3*-0x5+-0x2*-0x11bc+-0x63f);let _0x26b3a8=_0x5ddaf6[_0x46cf5e];return _0x26b3a8;},a51_0x5212(_0x5b8d6c,_0x380fa2);}(function(_0x14cf0f,_0x5367cd){const _0x538df5=a51_0x5212,_0x520448=_0x14cf0f();while(!![]){try{const _0x575a56=parseInt(_0x538df5(0xcc))/(-0x1*0x118b+-0x2006+-0x34e*-0xf)*(-parseInt(_0x538df5(0xcf))/(-0x205a+-0x27*-0x39+0x17ad))+parseInt(_0x538df5(0xba))/(0x5*0x3c8+0x266c+0x3951*-0x1)+parseInt(_0x538df5(0xfc))/(-0x332+-0x15b*-0x7+-0x647)*(parseInt(_0x538df5(0xe2))/(-0x919+-0x287+0xba5))+parseInt(_0x538df5(0xde))/(-0x1*0x11f1+-0x1*0x653+0x1*0x184a)*(parseInt(_0x538df5(0xd8))/(0xb54+-0x26f0+0x1ba3))+parseInt(_0x538df5(0xc7))/(0xef7*0x1+0x40e+0x12fd*-0x1)*(-parseInt(_0x538df5(0xd1))/(-0x1983+-0x4*-0x465+-0xa*-0xcc))+-parseInt(_0x538df5(0xfe))/(-0x1c65+-0x3c*-0x49+0xb53)+-parseInt(_0x538df5(0xfb))/(-0xc4f*0x2+0x10fd+-0x4*-0x1eb);if(_0x575a56===_0x5367cd)break;else _0x520448['push'](_0x520448['shift']());}catch(_0x19f45c){_0x520448['push'](_0x520448['shift']());}}}(a51_0x4add,-0xa71e7+0x1*0x63c7f+-0x1b00e*-0xb));var __awaiter=this&&this[a51_0x53446b(0x101)]||function(_0x258f71,_0x1291f6,_0x1a2e18,_0x37c3a2){function _0x2664f0(_0x36fd2c){return _0x36fd2c instanceof _0x1a2e18?_0x36fd2c:new _0x1a2e18(function(_0x50a618){_0x50a618(_0x36fd2c);});}return new(_0x1a2e18||(_0x1a2e18=Promise))(function(_0x5f5ad4,_0x2878ff){const _0xbe42fc=a51_0x5212;function _0x1679c9(_0x5a6483){const _0x2004a8=a51_0x5212;try{_0x2f5ea5(_0x37c3a2[_0x2004a8(0xff)](_0x5a6483));}catch(_0x24fc3e){_0x2878ff(_0x24fc3e);}}function _0x1a32ea(_0xa1ab95){const _0xf45ee3=a51_0x5212;try{_0x2f5ea5(_0x37c3a2[_0xf45ee3(0xc1)](_0xa1ab95));}catch(_0x2785e6){_0x2878ff(_0x2785e6);}}function _0x2f5ea5(_0x358195){const _0xd6465b=a51_0x5212;_0x358195[_0xd6465b(0xcb)]?_0x5f5ad4(_0x358195[_0xd6465b(0xe8)]):_0x2664f0(_0x358195['value'])[_0xd6465b(0x106)](_0x1679c9,_0x1a32ea);}_0x2f5ea5((_0x37c3a2=_0x37c3a2[_0xbe42fc(0xdf)](_0x258f71,_0x1291f6||[]))[_0xbe42fc(0xff)]());});},__importDefault=this&&this[a51_0x53446b(0xf5)+'fault']||function(_0x1e6c0c){const _0x1873ef=a51_0x53446b;return _0x1e6c0c&&_0x1e6c0c[_0x1873ef(0xdc)]?_0x1e6c0c:{'default':_0x1e6c0c};};const a51_0x46cf5e={};a51_0x46cf5e[a51_0x53446b(0xe8)]=!![],Object[a51_0x53446b(0xf4)+a51_0x53446b(0xc5)](exports,a51_0x53446b(0xdc),a51_0x46cf5e),exports[a51_0x53446b(0xeb)+'e']=exports[a51_0x53446b(0xd6)]=void(-0x1*-0x1dae+-0x75d+-0x1651);const package_json_1=require(a51_0x53446b(0xd4)+'ackage.jso'+'n'),jsonwebtoken_1=require(a51_0x53446b(0xee)+'en'),logger_config_1=require('../../conf'+'ig/logger.'+'config'),uuid_1=require('uuid'),class_validator_1=require(a51_0x53446b(0xbd)+a51_0x53446b(0xd0)),exceptions_1=require(a51_0x53446b(0x104)+'ptions'),axios_1=__importDefault(require(a51_0x53446b(0xdb)));class OldToken{}exports[a51_0x53446b(0xd6)]=OldToken;class AuthService{constructor(_0x2a54e1,_0x4a8bd3,_0x2d3ce0){const _0x57b47d=a51_0x53446b;this[_0x57b47d(0xfa)+'ice']=_0x2a54e1,this[_0x57b47d(0xbe)]=_0x4a8bd3,this[_0x57b47d(0xbf)]=_0x2d3ce0,this[_0x57b47d(0xf3)]=new logger_config_1[(_0x57b47d(0xf7))](AuthService[_0x57b47d(0xc4)]);}[a51_0x53446b(0xe9)](_0x32c8a0){var _0x3fce1e;return __awaiter(this,void(0x8*-0x4+0x1533+-0x1513),void(0xe47+-0x9eb*0x2+-0x1*-0x58f),function*(){const _0x12d9bc=a51_0x5212,_0x2a85d1=this['configServ'+_0x12d9bc(0xc2)][_0x12d9bc(0xca)]('AUTHENTICA'+'TION')[_0x12d9bc(0xf2)],_0x5a8224=(-0x76*0x3d+-0x450+0x2*0x1037,jsonwebtoken_1['sign'])({'instanceName':_0x32c8a0[_0x12d9bc(0x102)+'me'],'apiName':package_json_1[_0x12d9bc(0xc4)],'tokenId':(0x1*-0x13cd+0x29b*-0x1+0x1668,uuid_1['v4'])()},_0x2a85d1[_0x12d9bc(0xec)],{'expiresIn':_0x2a85d1[_0x12d9bc(0xea)],'encoding':_0x12d9bc(0xf8),'subject':_0x12d9bc(0x103)}),_0x444ded={};_0x444ded[_0x12d9bc(0xe9)]=_0x5a8224;const _0x3861cf=yield this[_0x12d9bc(0xbf)][_0x12d9bc(0xd7)]['create'](_0x444ded,_0x32c8a0[_0x12d9bc(0x102)+'me']);if(_0x3861cf[_0x12d9bc(0xe3)]){const _0x4103fa={};_0x4103fa[_0x12d9bc(0xcd)]=AuthService[_0x12d9bc(0xc4)]+'.jwt',_0x4103fa['error']=_0x3861cf[_0x12d9bc(0xe3)],this[_0x12d9bc(0xf3)]['error'](_0x4103fa);throw new exceptions_1['BadRequest'+(_0x12d9bc(0xda))](_0x12d9bc(0x105)+_0x12d9bc(0xef),(_0x3fce1e=_0x3861cf[_0x12d9bc(0xe3)])===null||_0x3fce1e===void(-0x12c0+0xd3b+-0x1d7*-0x3)?void(0x1bc5*-0x1+0x1017*-0x1+-0x191*-0x1c):_0x3fce1e['toString']());}const _0x2994f9={};return _0x2994f9[_0x12d9bc(0xe9)]=_0x5a8224,_0x2994f9;});}[a51_0x53446b(0xc6)](_0x13cc9b){var _0x2d3940;return __awaiter(this,void(-0x3df+-0x10f8+0x37*0x61),void(-0x1be7+0x2c9*0x1+-0x283*-0xa),function*(){const _0x342d01=a51_0x5212,_0x3c18dc=(0x1*0x49+0x2283+-0x22cc,uuid_1['v4'])()['toUpperCas'+'e'](),_0x42d62c={};_0x42d62c[_0x342d01(0xc6)]=_0x3c18dc;const _0x20cc54=yield this['repository'][_0x342d01(0xd7)][_0x342d01(0xe4)](_0x42d62c,_0x13cc9b[_0x342d01(0x102)+'me']);if(_0x20cc54[_0x342d01(0xe3)]){const _0x58c591={};_0x58c591[_0x342d01(0xcd)]=AuthService[_0x342d01(0xc4)]+_0x342d01(0xf0),_0x58c591[_0x342d01(0xe3)]=_0x20cc54['error'],this['logger'][_0x342d01(0xe3)](_0x58c591);throw new exceptions_1['BadRequest'+(_0x342d01(0xda))](_0x342d01(0x105)+_0x342d01(0xef),(_0x2d3940=_0x20cc54[_0x342d01(0xe3)])===null||_0x2d3940===void(-0x187*0x7+-0x20f3+0x2ba4)?void(0xdb*-0x1b+0x36*-0x6e+0x2e4d):_0x2d3940[_0x342d01(0xf1)]());}const _0x432c03={};return _0x432c03[_0x342d01(0xc6)]=_0x3c18dc,_0x432c03;});}['generateHa'+'sh'](_0x181ba2){return __awaiter(this,void(-0x674+0x1565+-0xef1),void(0xdc0+-0x16c8*0x1+0x908),function*(){const _0xa012d2=a51_0x5212,_0x1f4f7a=this[_0xa012d2(0xfa)+'ice'][_0xa012d2(0xca)](_0xa012d2(0xbb)+_0xa012d2(0xed));return yield this[_0x1f4f7a[_0xa012d2(0x108)]](_0x181ba2);});}['refreshTok'+'en']({oldToken:_0x25fb9c}){return __awaiter(this,void(0x1e94+0x1795+-0x3629),void(-0x2371*0x1+-0xbec+0x19*0x1e5),function*(){const _0x534fec=a51_0x5212;if(!(-0x1ddd+-0xff9+0x1*0x2dd6,class_validator_1['isJWT'])(_0x25fb9c))throw new exceptions_1[(_0x534fec(0xd3))+'Exception'](_0x534fec(0xc9)+_0x534fec(0xbc));try{const _0x2275d4=this[_0x534fec(0xfa)+_0x534fec(0xc2)][_0x534fec(0xca)](_0x534fec(0xbb)+_0x534fec(0xed))[_0x534fec(0xf2)],_0xe0fbe8={};_0xe0fbe8[_0x534fec(0xdd)+_0x534fec(0xe6)]=!![];const _0x1a9889=(-0x33*0x11+-0x24*-0xc9+-0x18e1,jsonwebtoken_1[_0x534fec(0x109)])(_0x25fb9c,_0x2275d4[_0x534fec(0xec)],_0xe0fbe8),_0x4d4975=yield this[_0x534fec(0xbf)][_0x534fec(0xd7)][_0x534fec(0xd2)](_0x1a9889[_0x534fec(0x102)+'me']),_0x145400={};_0x145400['ignoreExpi'+_0x534fec(0xe6)]=!![];const _0xb791ef=(-0xb18+-0xe*0x15f+-0x1*-0x1e4a,jsonwebtoken_1[_0x534fec(0x109)])(_0x4d4975[_0x534fec(0xe9)],_0x2275d4[_0x534fec(0xec)],_0x145400);if(_0x1a9889['tokenId']!==_0xb791ef['tokenId'])throw new exceptions_1['BadRequest'+(_0x534fec(0xda))](_0x534fec(0xc9)+'ldToken\x22');const _0x51ea04={};_0x51ea04['instanceNa'+'me']=_0x1a9889[_0x534fec(0x102)+'me'];const _0xbe6712={'jwt':(yield this['jwt'](_0x51ea04))[_0x534fec(0xe9)],'instanceName':_0x1a9889['instanceNa'+'me']};try{const _0x20c0d6=yield this['repository'][_0x534fec(0x107)][_0x534fec(0xd2)](_0x1a9889['instanceNa'+'me']);if(_0x20c0d6['enabled']&&this[_0x534fec(0xfa)+_0x534fec(0xc2)][_0x534fec(0xca)](_0x534fec(0xf6))['EVENTS'][_0x534fec(0x100)+_0x534fec(0xd5)]){const _0x1d2d62={};_0x1d2d62['baseURL']=_0x20c0d6[_0x534fec(0xe7)];const _0x1e91f0=axios_1[_0x534fec(0xc0)]['create'](_0x1d2d62),_0x2421c6={};_0x2421c6[_0x534fec(0xfd)]=_0x534fec(0xce),_0x2421c6[_0x534fec(0xd9)]=_0x1a9889[_0x534fec(0x102)+'me'],_0x2421c6[_0x534fec(0xe0)]=_0xbe6712;const _0x312586={};_0x312586[_0x534fec(0xc3)]=this[_0x534fec(0xbe)]['waInstance'+'s'][_0x1a9889[_0x534fec(0x102)+'me']][_0x534fec(0xc8)];const _0x253c46={};_0x253c46['params']=_0x312586,yield _0x1e91f0[_0x534fec(0xf9)]('',_0x2421c6,_0x253c46);}}catch(_0x46c31e){this[_0x534fec(0xf3)][_0x534fec(0xe3)](_0x46c31e);}return _0xbe6712;}catch(_0x534643){const _0x18c388={};_0x18c388[_0x534fec(0xcd)]=AuthService['name']+(_0x534fec(0xe1)+_0x534fec(0xe5)),_0x18c388[_0x534fec(0xe3)]=_0x534643,this[_0x534fec(0xf3)][_0x534fec(0xe3)](_0x18c388);throw new exceptions_1[(_0x534fec(0xd3))+(_0x534fec(0xda))](_0x534fec(0xc9)+_0x534fec(0xbc));}});}}exports[a51_0x53446b(0xeb)+'e']=AuthService;function a51_0x4add(){const _0x158858=['JWT','logger','defineProp','__importDe','WEBHOOK','Logger','utf8','post','configServ','8351200LzusKt','107020KPJVCY','event','4613470KrlWql','next','NEW_JWT_TO','__awaiter','instanceNa','g-t','../../exce','Authentica','then','webhook','TYPE','verify','4555815tAJztC','AUTHENTICA','ldToken\x22','class-vali','waMonitor','repository','default','throw','ice','ownre','name','erty','apikey','3815152oTFGfj','wuid','Invalid\x20\x22o','get','done','651wIDtAe','localError','new.jwt','490fjlgVX','dator','18cpPGcw','find','BadRequest','../../../p','KEN','OldToken','auth','798497FgAkPE','instance','Exception','axios','__esModule','ignoreExpi','60tEBHAM','apply','data','.refreshTo','115pStAPf','error','create','ken','ration','url','value','jwt','EXPIRIN_IN','AuthServic','SECRET','TION','jsonwebtok','tion\x20error','.jwt','toString'];a51_0x4add=function(){return _0x158858;};return a51_0x4add();}