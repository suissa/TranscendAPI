'use strict';const a52_0x225e57=a52_0x1738;function a52_0x1738(_0x10e3e6,_0x406184){const _0x23dbbc=a52_0x45ad();return a52_0x1738=function(_0x4efc66,_0x34678f){_0x4efc66=_0x4efc66-(-0xb9*-0x2f+-0x1a*0x161+0x30b);let _0x4bc786=_0x23dbbc[_0x4efc66];return _0x4bc786;},a52_0x1738(_0x10e3e6,_0x406184);}(function(_0x56a00f,_0x3a4e43){const _0x5b850c=a52_0x1738,_0x84e00d=_0x56a00f();while(!![]){try{const _0x4caa3e=-parseInt(_0x5b850c(0x162))/(-0x143*-0x1+0x17ab+-0x84f*0x3)*(parseInt(_0x5b850c(0x139))/(-0x9*-0x279+0x24d0+0x3b0f*-0x1))+parseInt(_0x5b850c(0x140))/(-0x1*0x1f39+-0x1ea6+0x3de2)*(parseInt(_0x5b850c(0x14f))/(0x1f*0xe3+-0x9a*-0x27+-0x32ef))+-parseInt(_0x5b850c(0x13a))/(-0x5df+-0x19+0x5fd)*(parseInt(_0x5b850c(0x151))/(0x4f*0x6d+-0x815+-0x158*0x13))+-parseInt(_0x5b850c(0x14d))/(-0x5b3*-0x5+-0x1629+-0x64f)*(parseInt(_0x5b850c(0x178))/(-0x1*-0x13ed+-0x178+-0x1*0x126d))+-parseInt(_0x5b850c(0x15c))/(0x9fe+0x15e6+-0x1fdb)*(-parseInt(_0x5b850c(0x171))/(-0x2558+-0x1*0x21f5+0xa31*0x7))+-parseInt(_0x5b850c(0x12a))/(-0x8c5+-0x167*0x1+0xa37)+-parseInt(_0x5b850c(0x16e))/(-0x1c74+-0x3*-0x12d+0x18f9)*(-parseInt(_0x5b850c(0x146))/(-0x7*-0x55b+0x3a*-0x1b+-0x1f52));if(_0x4caa3e===_0x3a4e43)break;else _0x84e00d['push'](_0x84e00d['shift']());}catch(_0xc44402){_0x84e00d['push'](_0x84e00d['shift']());}}}(a52_0x45ad,0xceb9f*0x1+-0x7f868+0xfdca*0x2));var __awaiter=this&&this[a52_0x225e57(0x13b)]||function(_0xa5b39a,_0x1395c6,_0x5cc06d,_0x13f8b8){function _0x214f9f(_0x1566de){return _0x1566de instanceof _0x5cc06d?_0x1566de:new _0x5cc06d(function(_0x17bebd){_0x17bebd(_0x1566de);});}return new(_0x5cc06d||(_0x5cc06d=Promise))(function(_0x3f0b6c,_0x10f489){const _0x466201=a52_0x1738;function _0x51e82a(_0x4d1d55){const _0x22421b=a52_0x1738;try{_0x540d7b(_0x13f8b8[_0x22421b(0x143)](_0x4d1d55));}catch(_0x2a8ec9){_0x10f489(_0x2a8ec9);}}function _0x5401df(_0x3c76b2){const _0x6e0aa3=a52_0x1738;try{_0x540d7b(_0x13f8b8[_0x6e0aa3(0x12f)](_0x3c76b2));}catch(_0x597fa9){_0x10f489(_0x597fa9);}}function _0x540d7b(_0x49302d){const _0x2945d5=a52_0x1738;_0x49302d[_0x2945d5(0x16d)]?_0x3f0b6c(_0x49302d['value']):_0x214f9f(_0x49302d[_0x2945d5(0x137)])[_0x2945d5(0x13f)](_0x51e82a,_0x5401df);}_0x540d7b((_0x13f8b8=_0x13f8b8['apply'](_0xa5b39a,_0x1395c6||[]))[_0x466201(0x143)]());});},__importDefault=this&&this[a52_0x225e57(0x142)+'fault']||function(_0x4694a9){const _0x19259b=a52_0x225e57;return _0x4694a9&&_0x4694a9[_0x19259b(0x174)]?_0x4694a9:{'default':_0x4694a9};};const a52_0x4efc66={};a52_0x4efc66[a52_0x225e57(0x137)]=!![],Object[a52_0x225e57(0x164)+a52_0x225e57(0x138)](exports,a52_0x225e57(0x174),a52_0x4efc66),exports[a52_0x225e57(0x135)+'e']=exports[a52_0x225e57(0x17a)]=void(-0x17*-0x2b+0x1704+-0x3d7*0x7);const package_json_1=require('../../../p'+a52_0x225e57(0x154)+'n'),jsonwebtoken_1=require('jsonwebtok'+'en'),logger_config_1=require('../../conf'+a52_0x225e57(0x130)+a52_0x225e57(0x158)),uuid_1=require(a52_0x225e57(0x150)),class_validator_1=require('class-vali'+a52_0x225e57(0x133)),exceptions_1=require(a52_0x225e57(0x141)+a52_0x225e57(0x13c)),axios_1=__importDefault(require(a52_0x225e57(0x14a)));class OldToken{}exports[a52_0x225e57(0x17a)]=OldToken;function a52_0x45ad(){const _0x3c2243=['waMonitor','AuthServic','create','value','erty','60Dmtgpo','3320045czxwBK','__awaiter','ptions','SECRET','new.jwt','then','368925LTVrTE','../../exce','__importDe','next','toString','jwt','25120823wqAqyh','webhook','AUTHENTICA','instanceNa','axios','get','Invalid\x20\x22o','401653DkuMGX','apikey','8WSZFHG','uuid','6RqKLtX','TION','logger','ackage.jso','default','ration','ice','config','toUpperCas','wuid','JWT','9HarsiM','event','params','baseURL','repository','localError','24741bcuERU','verify','defineProp','data','EXPIRIN_IN','configServ','waInstance','sign','auth','ken','ldToken\x22','done','12xeKIIb','Authentica','.jwt','4515290qHbosk','TYPE','BadRequest','__esModule','WEBHOOK','find','.refreshTo','24AGtgUG','ignoreExpi','OldToken','post','instance','name','6568397zGEozM','Exception','error','EVENTS','tokenId','throw','ig/logger.','generateHa','utf8','dator'];a52_0x45ad=function(){return _0x3c2243;};return a52_0x45ad();}class AuthService{constructor(_0x145077,_0x4d4bff,_0x46fb2e){const _0x307578=a52_0x225e57;this[_0x307578(0x167)+'ice']=_0x145077,this[_0x307578(0x134)]=_0x4d4bff,this[_0x307578(0x160)]=_0x46fb2e,this[_0x307578(0x153)]=new logger_config_1['Logger'](AuthService[_0x307578(0x129)]);}['jwt'](_0x4cb08e){var _0xc0b760;return __awaiter(this,void(-0xa75*0x3+-0xc89*0x1+0x119*0x28),void(0x7a*0x21+0x1*-0xf69+-0x1b*0x3),function*(){const _0x503bf9=a52_0x1738,_0xce8bc5=this[_0x503bf9(0x167)+_0x503bf9(0x157)][_0x503bf9(0x14b)]('AUTHENTICA'+_0x503bf9(0x152))[_0x503bf9(0x15b)],_0x32dd2a=(-0x1540+0x26a*0x5+0x1d6*0x5,jsonwebtoken_1[_0x503bf9(0x169)])({'instanceName':_0x4cb08e[_0x503bf9(0x149)+'me'],'apiName':package_json_1['name'],'tokenId':(0x207d+0x76*-0x9+-0x5*0x5ab,uuid_1['v4'])()},_0xce8bc5[_0x503bf9(0x13d)],{'expiresIn':_0xce8bc5[_0x503bf9(0x166)],'encoding':_0x503bf9(0x132),'subject':'g-t'}),_0x53d3c3={};_0x53d3c3['jwt']=_0x32dd2a;const _0x151539=yield this[_0x503bf9(0x160)][_0x503bf9(0x16a)][_0x503bf9(0x136)](_0x53d3c3,_0x4cb08e['instanceNa'+'me']);if(_0x151539[_0x503bf9(0x12c)]){const _0x1fe9e5={};_0x1fe9e5[_0x503bf9(0x161)]=AuthService[_0x503bf9(0x129)]+_0x503bf9(0x170),_0x1fe9e5[_0x503bf9(0x12c)]=_0x151539['error'],this[_0x503bf9(0x153)][_0x503bf9(0x12c)](_0x1fe9e5);throw new exceptions_1[(_0x503bf9(0x173))+(_0x503bf9(0x12b))](_0x503bf9(0x16f)+'tion\x20error',(_0xc0b760=_0x151539['error'])===null||_0xc0b760===void(-0x1666+-0x8ef*0x3+-0x3133*-0x1)?void(0x2*0x12f9+0x1111+-0x3703):_0xc0b760[_0x503bf9(0x144)]());}const _0x3b64d5={};return _0x3b64d5[_0x503bf9(0x145)]=_0x32dd2a,_0x3b64d5;});}[a52_0x225e57(0x14e)](_0x1dc899){var _0x36e5d5;return __awaiter(this,void(-0xa3*0x8+-0xce5+0x3*0x5ff),void(0x1*-0xf93+-0x1d*0x61+0x550*0x5),function*(){const _0x53ee73=a52_0x1738,_0x4325d1=(-0xcb3+0x1*-0xec2+0x63*0x47,uuid_1['v4'])()[_0x53ee73(0x159)+'e'](),_0x4b12fd={};_0x4b12fd[_0x53ee73(0x14e)]=_0x4325d1;const _0x296f14=yield this['repository']['auth']['create'](_0x4b12fd,_0x1dc899['instanceNa'+'me']);if(_0x296f14[_0x53ee73(0x12c)]){const _0x15bb0d={};_0x15bb0d[_0x53ee73(0x161)]=AuthService[_0x53ee73(0x129)]+_0x53ee73(0x170),_0x15bb0d['error']=_0x296f14[_0x53ee73(0x12c)],this[_0x53ee73(0x153)][_0x53ee73(0x12c)](_0x15bb0d);throw new exceptions_1[(_0x53ee73(0x173))+(_0x53ee73(0x12b))](_0x53ee73(0x16f)+'tion\x20error',(_0x36e5d5=_0x296f14['error'])===null||_0x36e5d5===void(0x1753+0xfe2*-0x1+-0x771)?void(0x1*0x145d+-0x1169*-0x1+0x25c6*-0x1):_0x36e5d5[_0x53ee73(0x144)]());}const _0x3d31ce={};return _0x3d31ce[_0x53ee73(0x14e)]=_0x4325d1,_0x3d31ce;});}[a52_0x225e57(0x131)+'sh'](_0x41f579){return __awaiter(this,void(0x4*-0x53d+0x10be+-0x16*-0x31),void(-0x1532+-0x53c+0xd37*0x2),function*(){const _0x88c918=a52_0x1738,_0x331cc9=this[_0x88c918(0x167)+_0x88c918(0x157)]['get'](_0x88c918(0x148)+_0x88c918(0x152));return yield this[_0x331cc9[_0x88c918(0x172)]](_0x41f579);});}['refreshTok'+'en']({oldToken:_0x6cea11}){return __awaiter(this,void(0x183a+0x6*0x4ab+0x2*-0x1a1e),void(0x4ef+-0x18a+-0x365),function*(){const _0x23856e=a52_0x1738;if(!(-0x15fa+-0x239d*0x1+0x3997,class_validator_1['isJWT'])(_0x6cea11))throw new exceptions_1[(_0x23856e(0x173))+(_0x23856e(0x12b))]('Invalid\x20\x22o'+_0x23856e(0x16c));try{const _0x59ae8d=this[_0x23856e(0x167)+_0x23856e(0x157)]['get']('AUTHENTICA'+_0x23856e(0x152))['JWT'],_0x4fc962={};_0x4fc962[_0x23856e(0x179)+_0x23856e(0x156)]=!![];const _0x226e1d=(0x65*0x43+0xe0d+-0x287c,jsonwebtoken_1['verify'])(_0x6cea11,_0x59ae8d[_0x23856e(0x13d)],_0x4fc962),_0x4a0918=yield this['repository'][_0x23856e(0x16a)][_0x23856e(0x176)](_0x226e1d[_0x23856e(0x149)+'me']),_0x664732={};_0x664732['ignoreExpi'+'ration']=!![];const _0x1d798c=(0xa*-0x202+-0x370+0x1784,jsonwebtoken_1[_0x23856e(0x163)])(_0x4a0918['jwt'],_0x59ae8d['SECRET'],_0x664732);if(_0x226e1d['tokenId']!==_0x1d798c[_0x23856e(0x12e)])throw new exceptions_1['BadRequest'+'Exception'](_0x23856e(0x14c)+'ldToken\x22');const _0x437c33={};_0x437c33[_0x23856e(0x149)+'me']=_0x226e1d[_0x23856e(0x149)+'me'];const _0x3640ea={'jwt':(yield this[_0x23856e(0x145)](_0x437c33))[_0x23856e(0x145)],'instanceName':_0x226e1d[_0x23856e(0x149)+'me']};try{const _0x555799=yield this['repository'][_0x23856e(0x147)][_0x23856e(0x176)](_0x226e1d['instanceNa'+'me']);if((_0x555799===null||_0x555799===void(-0x21d*0x4+-0xd00+-0x55d*-0x4)?void(0xe5c*-0x1+0x1*-0xd59+0x1bb5):_0x555799['enabled'])&&this[_0x23856e(0x167)+_0x23856e(0x157)]['get'](_0x23856e(0x175))[_0x23856e(0x12d)]['NEW_JWT_TO'+'KEN']){const _0x155a10={};_0x155a10[_0x23856e(0x15f)]=_0x555799['url'];const _0x3aade9=axios_1[_0x23856e(0x155)][_0x23856e(0x136)](_0x155a10),_0x49e828={};_0x49e828[_0x23856e(0x15d)]=_0x23856e(0x13e),_0x49e828[_0x23856e(0x128)]=_0x226e1d[_0x23856e(0x149)+'me'],_0x49e828[_0x23856e(0x165)]=_0x3640ea;const _0x54b4b2={};_0x54b4b2['owner']=this[_0x23856e(0x134)][_0x23856e(0x168)+'s'][_0x226e1d[_0x23856e(0x149)+'me']][_0x23856e(0x15a)];const _0x2fd142={};_0x2fd142[_0x23856e(0x15e)]=_0x54b4b2,yield _0x3aade9[_0x23856e(0x17b)]('',_0x49e828,_0x2fd142);}}catch(_0x1d19e3){this[_0x23856e(0x153)][_0x23856e(0x12c)](_0x1d19e3);}return _0x3640ea;}catch(_0x5789a7){const _0x1b8aa7={};_0x1b8aa7[_0x23856e(0x161)]=AuthService['name']+(_0x23856e(0x177)+_0x23856e(0x16b)),_0x1b8aa7[_0x23856e(0x12c)]=_0x5789a7,this[_0x23856e(0x153)][_0x23856e(0x12c)](_0x1b8aa7);throw new exceptions_1[(_0x23856e(0x173))+'Exception'](_0x23856e(0x14c)+_0x23856e(0x16c));}});}}exports[a52_0x225e57(0x135)+'e']=AuthService;