'use strict';const a51_0x342d88=a51_0x330e;(function(_0x587a70,_0x191451){const _0x2eebb0=a51_0x330e,_0x574a3a=_0x587a70();while(!![]){try{const _0x1f33c0=parseInt(_0x2eebb0(0x105))/(-0xca8+0x1723*-0x1+0x23cc)+-parseInt(_0x2eebb0(0xfd))/(0xb64+0xbe3*0x2+-0x2328)*(parseInt(_0x2eebb0(0x100))/(0x6*-0xe+0x1*-0x2525+-0x95f*-0x4))+-parseInt(_0x2eebb0(0xef))/(-0x2510+-0x6*0x53d+0x4482)+parseInt(_0x2eebb0(0x125))/(-0x145f+-0x1*-0xa0d+0xa57)+parseInt(_0x2eebb0(0x11c))/(0x1e2+-0x103d+0xe61)+-parseInt(_0x2eebb0(0x12c))/(-0x157c+0x469*-0x6+0x2ff9)+-parseInt(_0x2eebb0(0x11f))/(0x25*0x15+0x1*0x1b37+-0x1e38);if(_0x1f33c0===_0x191451)break;else _0x574a3a['push'](_0x574a3a['shift']());}catch(_0x1a0c10){_0x574a3a['push'](_0x574a3a['shift']());}}}(a51_0x5d26,-0x3*0x44de1+-0xee411+-0x2692eb*-0x1));function a51_0x330e(_0x367913,_0x2b253a){const _0x2379c3=a51_0x5d26();return a51_0x330e=function(_0x29cdeb,_0x2a2aba){_0x29cdeb=_0x29cdeb-(0x1*-0x197f+0x17ec*0x1+0x3*0xd1);let _0xdfc0c9=_0x2379c3[_0x29cdeb];return _0xdfc0c9;},a51_0x330e(_0x367913,_0x2b253a);}var __awaiter=this&&this['__awaiter']||function(_0x5758d3,_0x178d34,_0xf6348e,_0x4ad0ce){function _0x48acc0(_0x415313){return _0x415313 instanceof _0xf6348e?_0x415313:new _0xf6348e(function(_0x748327){_0x748327(_0x415313);});}return new(_0xf6348e||(_0xf6348e=Promise))(function(_0x45079f,_0x287e15){const _0x182f80=a51_0x330e;function _0x2c93bd(_0x545ad6){const _0x333b58=a51_0x330e;try{_0x45b4de(_0x4ad0ce[_0x333b58(0x115)](_0x545ad6));}catch(_0x3a3221){_0x287e15(_0x3a3221);}}function _0x5d9d43(_0x4a75d2){const _0x464ce7=a51_0x330e;try{_0x45b4de(_0x4ad0ce[_0x464ce7(0x118)](_0x4a75d2));}catch(_0x393fb3){_0x287e15(_0x393fb3);}}function _0x45b4de(_0x19eec4){const _0x1a7eb5=a51_0x330e;_0x19eec4[_0x1a7eb5(0x124)]?_0x45079f(_0x19eec4[_0x1a7eb5(0xea)]):_0x48acc0(_0x19eec4[_0x1a7eb5(0xea)])['then'](_0x2c93bd,_0x5d9d43);}_0x45b4de((_0x4ad0ce=_0x4ad0ce[_0x182f80(0xe0)](_0x5758d3,_0x178d34||[]))['next']());});},__importDefault=this&&this['__importDe'+a51_0x342d88(0xed)]||function(_0x593550){const _0xd5f318=a51_0x342d88;return _0x593550&&_0x593550[_0xd5f318(0x11a)]?_0x593550:{'default':_0x593550};};const a51_0x2379c3={};a51_0x2379c3[a51_0x342d88(0xea)]=!![],Object[a51_0x342d88(0xfc)+a51_0x342d88(0x12f)](exports,a51_0x342d88(0x11a),a51_0x2379c3),exports[a51_0x342d88(0xe3)+'e']=exports[a51_0x342d88(0x10c)]=void(-0x4d2+0x182*-0x3+0x958);const package_json_1=require('../../../p'+'ackage.jso'+'n'),jsonwebtoken_1=require(a51_0x342d88(0x11e)+'en'),logger_config_1=require('../../conf'+a51_0x342d88(0x126)+a51_0x342d88(0xec)),uuid_1=require(a51_0x342d88(0x119)),class_validator_1=require(a51_0x342d88(0x128)+a51_0x342d88(0xe4)),exceptions_1=require(a51_0x342d88(0xe8)+a51_0x342d88(0x117)),axios_1=__importDefault(require(a51_0x342d88(0x101)));class OldToken{}exports['OldToken']=OldToken;class AuthService{constructor(_0x2c4528,_0x1705fb,_0x680c5){const _0x5f1265=a51_0x342d88;this[_0x5f1265(0xfb)+'ice']=_0x2c4528,this['waMonitor']=_0x1705fb,this['repository']=_0x680c5,this[_0x5f1265(0x12a)]=new logger_config_1[(_0x5f1265(0x121))](AuthService[_0x5f1265(0xff)]);}[a51_0x342d88(0x108)](_0x43a923){var _0x3e7c02;return __awaiter(this,void(-0x1*0x1d2d+-0x1*0x1f49+0x3c76),void(-0x199d*0x1+-0x109*0x1b+0x3590),function*(){const _0x162fb3=a51_0x330e,_0x2d2e1a=this['configServ'+'ice'][_0x162fb3(0x10a)](_0x162fb3(0x10b)+'TION')[_0x162fb3(0xf2)],_0x3f3d32=(0x6*0x10d+-0x17c+-0x1*0x4d2,jsonwebtoken_1[_0x162fb3(0x123)])({'instanceName':_0x43a923[_0x162fb3(0x12e)+'me'],'apiName':package_json_1[_0x162fb3(0xff)],'tokenId':(0x90b+0x9ec+-0x5*0x3cb,uuid_1['v4'])()},_0x2d2e1a[_0x162fb3(0x102)],{'expiresIn':_0x2d2e1a['EXPIRIN_IN'],'encoding':'utf8','subject':_0x162fb3(0xe1)}),_0x549d86={};_0x549d86[_0x162fb3(0x108)]=_0x3f3d32;const _0x1f41e9=yield this['repository']['auth'][_0x162fb3(0xf1)](_0x549d86,_0x43a923[_0x162fb3(0x12e)+'me']);if(_0x1f41e9[_0x162fb3(0x109)]){const _0x13a44a={};_0x13a44a['localError']=AuthService[_0x162fb3(0xff)]+'.jwt',_0x13a44a[_0x162fb3(0x109)]=_0x1f41e9['error'],this[_0x162fb3(0x12a)][_0x162fb3(0x109)](_0x13a44a);throw new exceptions_1[(_0x162fb3(0x112))+(_0x162fb3(0xf9))]('Authentica'+_0x162fb3(0xe5),(_0x3e7c02=_0x1f41e9[_0x162fb3(0x109)])===null||_0x3e7c02===void(0x159a+-0x1269+0x331*-0x1)?void(0x71c+-0x22f8+-0x4*-0x6f7):_0x3e7c02[_0x162fb3(0xf7)]());}const _0x4285b1={};return _0x4285b1[_0x162fb3(0x108)]=_0x3f3d32,_0x4285b1;});}[a51_0x342d88(0xe7)](_0x1cd40f){var _0xbc5ece;return __awaiter(this,void(0x8*0x37c+0x11df+-0xef*0x31),void(0x1*0xab6+-0x667+-0x44f),function*(){const _0x191c71=a51_0x330e,_0x43636a=(-0x16ad+-0x27*-0xfb+-0x2*0x7c8,uuid_1['v4'])()['toUpperCas'+'e'](),_0x19c9b1={};_0x19c9b1[_0x191c71(0xe7)]=_0x43636a;const _0xb7dfab=yield this['repository'][_0x191c71(0xfa)][_0x191c71(0xf1)](_0x19c9b1,_0x1cd40f['instanceNa'+'me']);if(_0xb7dfab[_0x191c71(0x109)]){const _0x1c34c8={};_0x1c34c8[_0x191c71(0xe2)]=AuthService[_0x191c71(0xff)]+_0x191c71(0x103),_0x1c34c8['error']=_0xb7dfab[_0x191c71(0x109)],this['logger'][_0x191c71(0x109)](_0x1c34c8);throw new exceptions_1[(_0x191c71(0x112))+(_0x191c71(0xf9))](_0x191c71(0xf6)+_0x191c71(0xe5),(_0xbc5ece=_0xb7dfab[_0x191c71(0x109)])===null||_0xbc5ece===void(0x101b+0x183f+0xa*-0x409)?void(-0x1b98+0x1*0x1366+-0x419*-0x2):_0xbc5ece['toString']());}const _0x526835={};return _0x526835[_0x191c71(0xe7)]=_0x43636a,_0x526835;});}[a51_0x342d88(0xee)+'sh'](_0x446083){return __awaiter(this,void(-0x10b6+0x1*0x1451+-0x39b),void(-0xde7*0x2+-0xb25*-0x1+0x5*0x355),function*(){const _0x3c1ea6=a51_0x330e,_0x473961=this[_0x3c1ea6(0xfb)+_0x3c1ea6(0x106)]['get']('AUTHENTICA'+_0x3c1ea6(0x11b));return yield this[_0x473961[_0x3c1ea6(0x122)]](_0x446083);});}['refreshTok'+'en']({oldToken:_0x215b96}){return __awaiter(this,void(0x1d7b+0x24df*0x1+-0x425a),void(0x10*-0x47+-0x1f23+-0x7*-0x515),function*(){const _0x278b7b=a51_0x330e;if(!(-0x215b+0x7a*0x40+0x1*0x2db,class_validator_1['isJWT'])(_0x215b96))throw new exceptions_1['BadRequest'+(_0x278b7b(0xf9))](_0x278b7b(0x12b)+'ldToken\x22');try{const _0x7527d3=this[_0x278b7b(0xfb)+_0x278b7b(0x106)][_0x278b7b(0x10a)](_0x278b7b(0x10b)+_0x278b7b(0x11b))[_0x278b7b(0xf2)],_0x1b981b={};_0x1b981b['ignoreExpi'+_0x278b7b(0xe9)]=!![];const _0x151aaa=(0x185b+0x533*-0x7+0xc0a,jsonwebtoken_1[_0x278b7b(0x10d)])(_0x215b96,_0x7527d3[_0x278b7b(0x102)],_0x1b981b),_0x327193=yield this[_0x278b7b(0xf3)]['auth'][_0x278b7b(0xeb)](_0x151aaa[_0x278b7b(0x12e)+'me']),_0x46cd2b={};_0x46cd2b[_0x278b7b(0x11d)+_0x278b7b(0xe9)]=!![];const _0x144a29=(0x162f+0x2bb+-0x18ea,jsonwebtoken_1[_0x278b7b(0x10d)])(_0x327193[_0x278b7b(0x108)],_0x7527d3[_0x278b7b(0x102)],_0x46cd2b);if(_0x151aaa['tokenId']!==_0x144a29[_0x278b7b(0x10f)])throw new exceptions_1[(_0x278b7b(0x112))+(_0x278b7b(0xf9))](_0x278b7b(0x12b)+'ldToken\x22');const _0x118937={};_0x118937[_0x278b7b(0x12e)+'me']=_0x151aaa['instanceNa'+'me'];const _0x39ac3e={'jwt':(yield this['jwt'](_0x118937))[_0x278b7b(0x108)],'instanceName':_0x151aaa['instanceNa'+'me']};try{const _0x4bc8b6=yield this[_0x278b7b(0xf3)][_0x278b7b(0xf5)][_0x278b7b(0xeb)](_0x151aaa[_0x278b7b(0x12e)+'me']);if(_0x4bc8b6[_0x278b7b(0xf0)]&&this[_0x278b7b(0xfb)+'ice'][_0x278b7b(0x10a)](_0x278b7b(0x120))[_0x278b7b(0x116)][_0x278b7b(0x113)+_0x278b7b(0x10e)]){const _0x510202={};_0x510202[_0x278b7b(0xf4)]=_0x4bc8b6[_0x278b7b(0x107)];const _0x5ef182=axios_1[_0x278b7b(0x104)][_0x278b7b(0xf1)](_0x510202),_0x2782bb={};_0x2782bb['event']=_0x278b7b(0xe6),_0x2782bb[_0x278b7b(0xf8)]=_0x151aaa[_0x278b7b(0x12e)+'me'],_0x2782bb[_0x278b7b(0xfe)]=_0x39ac3e;const _0x2d4a8e={};_0x2d4a8e[_0x278b7b(0x129)]=this['waMonitor'][_0x278b7b(0x111)+'s'][_0x151aaa[_0x278b7b(0x12e)+'me']]['wuid'];const _0x133779={};_0x133779[_0x278b7b(0x127)]=_0x2d4a8e,yield _0x5ef182[_0x278b7b(0x110)]('',_0x2782bb,_0x133779);}}catch(_0xd2c3f1){this[_0x278b7b(0x12a)][_0x278b7b(0x109)](_0xd2c3f1);}return _0x39ac3e;}catch(_0x2a7c4b){const _0x361040={};_0x361040[_0x278b7b(0xe2)]=AuthService[_0x278b7b(0xff)]+(_0x278b7b(0x114)+'ken'),_0x361040[_0x278b7b(0x109)]=_0x2a7c4b,this[_0x278b7b(0x12a)][_0x278b7b(0x109)](_0x361040);throw new exceptions_1[(_0x278b7b(0x112))+'Exception'](_0x278b7b(0x12b)+_0x278b7b(0x12d));}});}}function a51_0x5d26(){const _0x1c0d03=['logger','Invalid\x20\x22o','23156PAIAgl','ldToken\x22','instanceNa','erty','apply','g-t','localError','AuthServic','dator','tion\x20error','new.jwt','apikey','../../exce','ration','value','find','config','fault','generateHa','1436072aOtvyK','enabled','create','JWT','repository','baseURL','webhook','Authentica','toString','instance','Exception','auth','configServ','defineProp','12ldqfzd','data','name','32940kGapcp','axios','SECRET','.jwt','default','698758xgwuab','ice','url','jwt','error','get','AUTHENTICA','OldToken','verify','KEN','tokenId','post','waInstance','BadRequest','NEW_JWT_TO','.refreshTo','next','EVENTS','ptions','throw','uuid','__esModule','TION','2165442GybBVN','ignoreExpi','jsonwebtok','9475936zOIJUj','WEBHOOK','Logger','TYPE','sign','done','6294400ufYktT','ig/logger.','params','class-vali','ownre'];a51_0x5d26=function(){return _0x1c0d03;};return a51_0x5d26();}exports[a51_0x342d88(0xe3)+'e']=AuthService;